<!DOCTYPE html><html lang="en"><head>
      

        <title>Drive II: Combine</title>
        <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
        <meta http-equiv="content-type" content="text/html; charset=utf-8">
        <meta charset="utf-8">
        <meta name="Description" content="Drive II: Combine, Functional Reactive Programming with Combine &amp; UIKit by Scott Orlyck">
        <meta name="twitter:title" content="Drive II: Combine">
        <meta name="twitter:description" content="">
        <meta name="twitter:image" content="">
        <meta name="twitter:card" content="summary_large_image">
        <meta name="twitter:site" content="">
        <meta name="twitter:creator" content="@orlyck">
        <meta property="og:url" content="">
        <meta property="og:title" content="Drive">
        <meta property="og:description" content="">
        <meta property="og:image" content="">
        <meta property="og:image:secure" content="">
    <style type="text/css">@font-face{font-display:swap;font-family:et-book;font-style:normal;font-weight:400;src:url(/et-book/et-book-roman-line-figures/et-book-roman-line-figures.eot);src:url(/et-book/et-book-roman-line-figures/et-book-roman-line-figures.eot?#iefix) format("embedded-opentype"),url(/et-book/et-book-roman-line-figures/et-book-roman-line-figures.woff) format("woff"),url(/et-book/et-book-roman-line-figures/et-book-roman-line-figures.ttf) format("truetype"),url(/et-book/et-book-roman-line-figures/et-book-roman-line-figures.svg#etbookromanosf) format("svg")}@font-face{font-display:swap;font-family:et-book;font-style:italic;font-weight:400;src:url(/et-book/et-book-display-italic-old-style-figures/et-book-display-italic-old-style-figures.eot);src:url(/et-book/et-book-display-italic-old-style-figures/et-book-display-italic-old-style-figures.eot?#iefix) format("embedded-opentype"),url(/et-book/et-book-display-italic-old-style-figures/et-book-display-italic-old-style-figures.woff) format("woff"),url(/et-book/et-book-display-italic-old-style-figures/et-book-display-italic-old-style-figures.ttf) format("truetype"),url(/et-book/et-book-display-italic-old-style-figures/et-book-display-italic-old-style-figures.svg#etbookromanosf) format("svg")}@font-face{font-display:swap;font-family:et-book;font-style:normal;font-weight:700;src:url(/et-book/et-book-bold-line-figures/et-book-bold-line-figures.eot);src:url(/et-book/et-book-bold-line-figures/et-book-bold-line-figures.eot?#iefix) format("embedded-opentype"),url(/et-book/et-book-bold-line-figures/et-book-bold-line-figures.woff) format("woff"),url(/et-book/et-book-bold-line-figures/et-book-bold-line-figures.ttf) format("truetype"),url(/et-book/et-book-bold-line-figures/et-book-bold-line-figures.svg#etbookromanosf) format("svg")}@font-face{font-display:swap;font-family:et-book-roman-old-style;font-style:normal;font-weight:400;src:url(/et-book/et-book-roman-old-style-figures/et-book-roman-old-style-figures.eot);src:url(/et-book/et-book-roman-old-style-figures/et-book-roman-old-style-figures.eot?#iefix) format("embedded-opentype"),url(/et-book/et-book-roman-old-style-figures/et-book-roman-old-style-figures.woff) format("woff"),url(/et-book/et-book-roman-old-style-figures/et-book-roman-old-style-figures.ttf) format("truetype"),url(/et-book/et-book-roman-old-style-figures/et-book-roman-old-style-figures.svg#etbookromanosf) format("svg")}html{font-size:15px}body{background-color:#fffff8;color:#111;counter-reset:sidenote-counter;font-family:et-book,Palatino,Palatino Linotype,Palatino LT STD,Book Antiqua,Georgia,serif;margin-left:auto;margin-right:auto;max-width:1400px;padding-left:12.5%;width:87.5%}@media (prefers-color-scheme:dark){body{background-color:#151515;color:#ddd}}h1{font-size:3.2rem;font-weight:400;line-height:1;margin-bottom:1.5rem;margin-top:4rem}h2{font-size:2.2rem;margin-top:2.1rem}h2,h3{font-style:italic;font-weight:400;line-height:1;margin-bottom:1.4rem}h3{font-size:1.7rem;margin-top:2rem}hr{border:0;border-top:1px solid #ccc;display:block;height:1px;margin:1em 0;padding:0;width:55%}p.subtitle{display:block;font-size:1.8rem;font-style:italic;line-height:1;margin-bottom:1rem;margin-top:1rem}.numeral{font-family:et-book-roman-old-style}.danger{color:red}article{padding:5rem 0}section{padding-bottom:1rem;padding-top:1rem}dl,ol,p,ul{font-size:1.4rem;line-height:2rem}p{margin-bottom:1.4rem;margin-top:1.4rem;padding-right:0;vertical-align:baseline}div.epigraph{margin:5em 0}div.epigraph>blockquote{margin-bottom:3em;margin-top:3em}div.epigraph>blockquote,div.epigraph>blockquote>p{font-style:italic}div.epigraph>blockquote>footer{font-style:normal}div.epigraph>blockquote>footer>cite{font-style:italic}blockquote{font-size:1.4rem}blockquote p{margin-right:40px;width:55%}blockquote footer{font-size:1.1rem;text-align:right;width:55%}section>footer,section>p,section>table{width:55%}section>dl,section>ol,section>ul{-webkit-padding-start:5%;width:50%}dt:not(:first-child),li:not(:first-child){margin-top:.25rem}figure{-webkit-margin-start:0;-webkit-margin-end:0;border:0;font-size:100%;font:inherit;margin:0 0 3em;max-width:55%;padding:0}figcaption,figure{vertical-align:baseline}figcaption{clear:right;float:right;font-size:1.1rem;line-height:1.6;margin-bottom:0;margin-top:0;max-width:40%;position:relative}figure.fullwidth figcaption{margin-right:24%}a:link,a:visited{color:inherit}.no-tufte-underline:link{background:unset;text-shadow:unset}.hover-tufte-underline:hover,.tufte-underline,a:link{background:linear-gradient(#fffff8,#fffff8),linear-gradient(#fffff8,#fffff8),linear-gradient(currentColor,currentColor);background-position:0 93%,100% 93%,0 93%;background-repeat:no-repeat,no-repeat,repeat-x;background-size:.05em 1px,.05em 1px,1px 1px;text-decoration:none;text-shadow:.03em 0 #fffff8,-.03em 0 #fffff8,0 .03em #fffff8,0 -.03em #fffff8,.06em 0 #fffff8,-.06em 0 #fffff8,.09em 0 #fffff8,-.09em 0 #fffff8,.12em 0 #fffff8,-.12em 0 #fffff8,.15em 0 #fffff8,-.15em 0 #fffff8}@media screen and (-webkit-min-device-pixel-ratio:0){.hover-tufte-underline:hover,.tufte-underline,a:link{background-position-y:87%,87%,87%}}@media (prefers-color-scheme:dark){.hover-tufte-underline:hover,.tufte-underline,a:link{text-shadow:.03em 0 #151515,-.03em 0 #151515,0 .03em #151515,0 -.03em #151515,.06em 0 #151515,-.06em 0 #151515,.09em 0 #151515,-.09em 0 #151515,.12em 0 #151515,-.12em 0 #151515,.15em 0 #151515,-.15em 0 #151515}}a:link::-moz-selection{background:#b4d5fe;text-shadow:.03em 0 #b4d5fe,-.03em 0 #b4d5fe,0 .03em #b4d5fe,0 -.03em #b4d5fe,.06em 0 #b4d5fe,-.06em 0 #b4d5fe,.09em 0 #b4d5fe,-.09em 0 #b4d5fe,.12em 0 #b4d5fe,-.12em 0 #b4d5fe,.15em 0 #b4d5fe,-.15em 0 #b4d5fe}a:link::-moz-selection,a:link::selection{background:#b4d5fe;text-shadow:.03em 0 #b4d5fe,-.03em 0 #b4d5fe,0 .03em #b4d5fe,0 -.03em #b4d5fe,.06em 0 #b4d5fe,-.06em 0 #b4d5fe,.09em 0 #b4d5fe,-.09em 0 #b4d5fe,.12em 0 #b4d5fe,-.12em 0 #b4d5fe,.15em 0 #b4d5fe,-.15em 0 #b4d5fe}img{max-width:100%}.marginnote,.sidenote{clear:right;float:right;font-size:1.1rem;line-height:1.3;margin-bottom:0;margin-right:-60%;margin-top:.3rem;position:relative;vertical-align:baseline;width:50%}.sidenote-number{counter-increment:sidenote-counter}.sidenote-number:after,.sidenote:before{font-family:et-book-roman-old-style;position:relative;vertical-align:baseline}.sidenote-number:after{content:counter(sidenote-counter);font-size:1rem;left:.1rem;top:-.5rem}.sidenote:before{content:counter(sidenote-counter) " ";font-size:1rem;top:-.5rem}blockquote .marginnote,blockquote .sidenote{margin-right:-82%;min-width:59%;text-align:left}div.fullwidth,table.fullwidth{width:100%}div.table-wrapper{font-family:Trebuchet MS,Gill Sans,Gill Sans MT,sans-serif;overflow-x:auto}.sans{font-family:Gill Sans,Gill Sans MT,Calibri,sans-serif;letter-spacing:.03em}code,pre>code{-webkit-text-size-adjust:100%;font-family:Consolas,Liberation Mono,Menlo,Courier,monospace;font-size:1rem;line-height:1.42}.sans>code{font-size:1.2rem}h1>code,h2>code,h3>code{font-size:.8em}.marginnote>code,.sidenote>code{font-size:1rem}pre>code{display:block;font-size:.9rem;margin-left:2.5%;overflow-x:auto;width:52.5%}pre.fullwidth>code{width:90%}.fullwidth{clear:both;max-width:90%}span.newthought{-webkit-font-feature-settings:"c2sc";font-feature-settings:"c2sc";font-size:1.2em;font-variant:small-caps}input.margin-toggle{display:none}label.sidenote-number{display:inline-block;max-height:2rem}label.margin-toggle:not(.sidenote-number){display:none}.iframe-wrapper{height:0;padding-bottom:56.25%;padding-top:25px;position:relative}.iframe-wrapper iframe{height:100%;left:0;position:absolute;top:0;width:100%}@media (max-width:760px){body{padding-left:8%;padding-right:8%;width:84%}hr,section>footer,section>p,section>table{width:100%}pre>code{width:97%}section>dl,section>ol,section>ul{width:90%}figure{max-width:90%}figcaption,figure.fullwidth figcaption{margin-right:0;max-width:none}blockquote{margin-left:1.5em;margin-right:0}blockquote footer,blockquote p{width:100%}label.margin-toggle:not(.sidenote-number){display:inline}.marginnote,.sidenote{display:none}.margin-toggle:checked+.marginnote,.margin-toggle:checked+.sidenote{clear:both;display:block;float:left;left:1rem;margin:1rem 2.5%;position:relative;vertical-align:baseline;width:95%}label{cursor:pointer}div.table-wrapper,table{width:85%}img{width:100%}}</style><style type="text/css">code[class*=language-],pre[class*=language-]{word-wrap:normal;background:none;color:#f8f8f2;font-family:Consolas,Monaco,Andale Mono,Ubuntu Mono,monospace;font-size:1em;-webkit-hyphens:none;-ms-hyphens:none;hyphens:none;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;text-align:left;text-shadow:0 1px rgba(0,0,0,.3);white-space:pre;word-break:normal;word-spacing:normal}pre[class*=language-]{border-radius:.3em;margin:.5em 0;overflow:auto;padding:1em}:not(pre)>code[class*=language-],pre[class*=language-]{background:#272822}:not(pre)>code[class*=language-]{border-radius:.3em;padding:.1em;white-space:normal}.token.cdata,.token.comment,.token.doctype,.token.prolog{color:#8292a2}.token.punctuation{color:#f8f8f2}.token.namespace{opacity:.7}.token.constant,.token.deleted,.token.property,.token.symbol,.token.tag{color:#f92672}.token.boolean,.token.number{color:#ae81ff}.token.attr-name,.token.builtin,.token.char,.token.inserted,.token.selector,.token.string{color:#a6e22e}.language-css .token.string,.style .token.string,.token.entity,.token.operator,.token.url,.token.variable{color:#f8f8f2}.token.atrule,.token.attr-value,.token.class-name,.token.function{color:#e6db74}.token.keyword{color:#66d9ef}.token.important,.token.regex{color:#fd971f}.token.bold,.token.important{font-weight:700}.token.italic{font-style:italic}.token.entity{cursor:help}pre[data-line]{padding:1em 0 1em 3em;position:relative}.line-highlight{background:hsla(24,20%,50%,.08);background:linear-gradient(90deg,hsla(24,20%,50%,.1) 70%,hsla(24,20%,50%,0));left:0;line-height:inherit;margin-top:1em;padding-bottom:inherit;padding-left:0;padding-right:0;padding-top:inherit;pointer-events:none;position:absolute;right:0;white-space:pre}@media print{.line-highlight{-webkit-print-color-adjust:exact;color-adjust:exact}}.line-highlight:before,.line-highlight[data-end]:after{background-color:hsla(24,20%,50%,.4);border-radius:999px;box-shadow:0 1px #fff;color:#f5f2f0;content:attr(data-start);font:700 65%/1.5 sans-serif;left:.6em;min-width:1em;padding:0 .5em;position:absolute;text-align:center;text-shadow:none;top:.4em;vertical-align:.3em}.line-highlight[data-end]:after{bottom:.4em;content:attr(data-end);top:auto}.line-numbers .line-highlight:after,.line-numbers .line-highlight:before{content:none}pre[id].linkable-line-numbers span.line-numbers-rows{pointer-events:all}pre[id].linkable-line-numbers span.line-numbers-rows>span:before{cursor:pointer}pre[id].linkable-line-numbers span.line-numbers-rows>span:hover:before{background-color:hsla(0,0%,50%,.2)}pre[class*=language-].line-numbers{counter-reset:linenumber;padding-left:3.8em;position:relative}pre[class*=language-].line-numbers>code{position:relative;white-space:inherit}.line-numbers .line-numbers-rows{border-right:1px solid #999;font-size:100%;left:-3.8em;letter-spacing:-1px;pointer-events:none;position:absolute;top:0;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;width:3em}.line-numbers-rows>span{counter-increment:linenumber;display:block}.line-numbers-rows>span:before{color:#999;content:counter(linenumber);display:block;padding-right:.8em;text-align:right}.small{font-size:.875rem;line-height:1.25rem}.code{width:100%}pre[class*=language-]{overflow:hidden}.line-highlight:before,.line-highlight[data-end]:after{box-shadow:none}</style></head>
    
<body>
<article><section><h1>Drive II: Combine</h1><p class="subtitle"><a href="https://linktr.ee/orlyck">Scott Orlyck</a></p></section><section><img src="https://images.unsplash.com/photo-1565647952915-9644fcd446a4?ixid=MnwxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8&amp;ixlib=rb-1.2.1&amp;auto=format&amp;fit=crop&amp;w=870&amp;q=80"><blockquote>"We ain't driving tractors here."</blockquote></section><section><p><span class="newthought">In our <a target="_blank" rel="noreferrer noopener" href="https://scottorly.github.io/drive-blog">last episode</a></span>, we implemented some practical UI techniques using Rx<label for="sn-demo" class="margin-toggle sidenote-number"></label><input type="checkbox" id="sn-demo" class="margin-toggle"><span class="sidenote"><a target="_blank" rel="noreferrer noopener" href="https://en.wikipedia.org/wiki/ReactiveX">ReactiveX</a>: Reactive Programming Extensions</span> with RxSwift's <a target="_blank" rel="noreferrer noopener" href="https://github.com/ReactiveX/RxSwift/blob/main/Documentation/Traits.md#driver">Driver Trait</a> and UIKit.</p><p>Below we are going to explore some of the same patterns (and a few new ones) using Apple's Swift Reactive Programming framework <a target="_blank" rel="noreferrer noopener" href="https://developer.apple.com/documentation/combine">Combine</a>. The compiler magic Apple has baked into Xcode add welcome ergonomics to the otherwise frustrating climb up the Rx learning curve. Rx based architectures can be a powerful tool to facilitate clean architecture so you can avoid half-cooked spagehetti<label for="sn-demo" class="margin-toggle sidenote-number"></label><input type="checkbox" id="sn-demo" class="margin-toggle"><span class="sidenote">Not enough seperation of concerns</span> or over-cooked lasgna<label for="sn-demo" class="margin-toggle sidenote-number"></label><input type="checkbox" id="sn-demo" class="margin-toggle"><span class="sidenote">Too many seperation of concerns</span> and maybe we'll find that Combine leads to cleaner and simpler code than RxSwift.</p></section><section><h2>The Return of the Driver</h2><p>If you recall RxSwift's Driver trait is a guarantee that the publisher is shared, the subscription is always received on the main thread and the publisher can never error out. It is instructive to think about Drivers as UI or system events "driving the application".</p><p></p><figure><label for="mn-demo" class="margin-toggle">⊕</label><input type="checkbox" id="mn-demo" class="margin-toggle"><span class="marginnote">Line 4: Typealias declaration.<br>Line 6: Catch and return an Empty publisher to convert the error type to Never.<br>Line 7: Parameter to return if there instead of an error when replacing the error type.<br>Line 8: Note the use of backticks in the function name.<br>Line 11: Share with replay of 1.<br>Line 12: Receive downstream subscriptions on the main thread.</span><p class="small"><pre data-line="4,6,7,8,11,12" class="  language-swift" tabindex="0"><code class="code  language-swift"><span class="token keyword">import</span> <span class="token class-name">Combine</span>
<span class="token keyword">import</span> <span class="token class-name">CombineExt</span>
                
<span class="token keyword">typealias</span> <span class="token class-name">Driver</span><span class="token operator">&lt;</span><span class="token class-name">T</span><span class="token operator">&gt;</span> <span class="token operator">=</span> <span class="token class-name">AnyPublisher</span><span class="token operator">&lt;</span><span class="token class-name">T</span><span class="token punctuation">,</span> <span class="token class-name">Never</span><span class="token operator">&gt;</span>

<span class="token keyword">extension</span> <span class="token class-name">Publisher</span> <span class="token punctuation">{</span>
    <span class="token keyword">func</span> <span class="token function-definition function">driver</span><span class="token punctuation">(</span>onErrorReturn<span class="token punctuation">:</span> <span class="token class-name">Output</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token class-name">Driver</span><span class="token operator">&lt;</span><span class="token class-name">Output</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
        `<span class="token keyword">catch</span>` <span class="token punctuation">{</span> error <span class="token operator">-&gt;</span> <span class="token class-name">AnyPublisher</span><span class="token operator">&lt;</span><span class="token class-name">Output</span><span class="token punctuation">,</span> <span class="token class-name">Never</span><span class="token operator">&gt;</span> <span class="token keyword">in</span>
            <span class="token class-name">Just</span><span class="token punctuation">(</span>onErrorReturn<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">eraseToAnyPublisher</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
        <span class="token punctuation">.</span><span class="token function">share</span><span class="token punctuation">(</span>replay<span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">receive</span><span class="token punctuation">(</span>on<span class="token punctuation">:</span> <span class="token class-name">RunLoop</span><span class="token punctuation">.</span>main<span class="token punctuation">,</span> options<span class="token punctuation">:</span> <span class="token nil constant">nil</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">eraseToAnyPublisher</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><div aria-hidden="true" data-range="4" class=" line-highlight" data-start="4" style="top: 57px; width: 394px;"> 
</div><div aria-hidden="true" data-range="6" class=" line-highlight" data-start="6" style="top: 95px; width: 394px;"> 
</div><div aria-hidden="true" data-range="7" class=" line-highlight" data-start="7" style="top: 114px; width: 394px;"> 
</div><div aria-hidden="true" data-range="8" class=" line-highlight" data-start="8" style="top: 133px; width: 394px;"> 
</div><div aria-hidden="true" data-range="11" class=" line-highlight" data-start="11" style="top: 190px; width: 394px;"> 
</div><div aria-hidden="true" data-range="12" class=" line-highlight" data-start="12" style="top: 209px; width: 394px;"> 
</div></code></pre></p></figure><figure><label for="mn-demo" class="margin-toggle">⊕</label><input type="checkbox" id="mn-demo" class="margin-toggle"><span class="marginnote">Line 4: Typealias declaration.<br>Line 6: Catch and return an Empty publisher to convert the error type to Never.<br>Line 7: Note the use of backticks in the function name.<br>Line 11:<br>Line 12:</span><p class="small"><pre data-line="4,6,7,11" class="  language-swift" tabindex="0"><code class="code  language-swift"><span class="token keyword">extension</span> <span class="token class-name">Publisher</span> <span class="token punctuation">{</span>

    <span class="token keyword">func</span> <span class="token function-definition function">driver</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token class-name">Driver</span><span class="token operator">&lt;</span><span class="token class-name">Output</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
        `<span class="token keyword">catch</span>` <span class="token punctuation">{</span> error <span class="token operator">-&gt;</span> <span class="token class-name">AnyPublisher</span><span class="token operator">&lt;</span><span class="token class-name">Output</span><span class="token punctuation">,</span> <span class="token class-name">Never</span><span class="token operator">&gt;</span> <span class="token keyword">in</span>
            <span class="token class-name">Empty</span><span class="token punctuation">(</span>completeImmediately<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">eraseToAnyPublisher</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
        <span class="token punctuation">.</span><span class="token function">share</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">receive</span><span class="token punctuation">(</span>on<span class="token punctuation">:</span> <span class="token class-name">RunLoop</span><span class="token punctuation">.</span>main<span class="token punctuation">,</span> options<span class="token punctuation">:</span> <span class="token nil constant">nil</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">eraseToAnyPublisher</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><div aria-hidden="true" data-range="4" class=" line-highlight" data-start="4" style="top: 57px; width: 394px;"> 
</div><div aria-hidden="true" data-range="6" class=" line-highlight" data-start="6" style="top: 95px; width: 394px;"> 
</div><div aria-hidden="true" data-range="7" class=" line-highlight" data-start="7" style="top: 114px; width: 394px;"> 
</div><div aria-hidden="true" data-range="11" class=" line-highlight" data-start="11" style="top: 190px; width: 394px;"> 
</div></code></pre></p></figure></section><section><h2><a target="_blank" rel="noreferrer noopener" href="https://developer.apple.com/documentation/uikit/uitableviewdiffabledatasource">Diffable Datasources</a></h2><p>For this tutorial we are going to explore another new iOS platform component that can help simplify our collection views especially handling datasources updates without the dreaded inconsistency crash.</p><p>Available in iOS 13 and above, Diffable Datasources can be used with UITableView and UICollectionView and are much cleaner implementations than the overly verbose traditional datasource and delegate methods.</p><figure><label for="mn-demo" class="margin-toggle">⊕</label><input type="checkbox" id="mn-demo" class="margin-toggle"><span class="marginnote">Assign the datasource property to the UITableView and create a new snapshot appending a new section and a new item to the section.</span><p class="small"><pre class="  language-swift" tabindex="0"><code class="code  language-swift"><span class="token keyword">import</span> <span class="token class-name">UIKit</span>

<span class="token keyword">typealias</span> <span class="token class-name">Datasource</span> <span class="token operator">=</span> <span class="token class-name">UITableViewDiffableDataSource</span><span class="token operator">&lt;</span><span class="token class-name">Int</span><span class="token punctuation">,</span> <span class="token class-name">Post</span><span class="token operator">&gt;</span>
<span class="token keyword">typealias</span> <span class="token class-name">Snapshot</span> <span class="token operator">=</span> <span class="token class-name">NSDiffableDataSourceSnapshot</span><span class="token operator">&lt;</span><span class="token class-name">Int</span><span class="token punctuation">,</span> <span class="token class-name">Post</span><span class="token operator">&gt;</span>
</code></pre></p></figure><p>Now we can setup our datasource and load some test items.</p><figure><label for="mn-demo" class="margin-toggle">⊕</label><input type="checkbox" id="mn-demo" class="margin-toggle"><span class="marginnote">Assign the datasource property to the UITableView and create a new snapshot appending a new section and a new item to the section.</span><p class="small"><pre class="  language-swift" tabindex="0"><code class="code  language-swift"><span class="token keyword">class</span> <span class="token class-name">ViewController</span><span class="token punctuation">:</span> <span class="token class-name">UIViewController</span> <span class="token punctuation">{</span>

    <span class="token attribute atrule">@IBOutlet</span> <span class="token keyword">weak</span> <span class="token keyword">var</span> tableView<span class="token punctuation">:</span> <span class="token class-name">UITableView</span><span class="token operator">!</span>

    <span class="token keyword">lazy</span> <span class="token keyword">var</span> datasource<span class="token punctuation">:</span> <span class="token class-name">Datasource</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
        <span class="token class-name">Datasource</span><span class="token punctuation">(</span>tableView<span class="token punctuation">:</span> tableView<span class="token punctuation">)</span> <span class="token punctuation">{</span> tableView<span class="token punctuation">,</span> indexPath<span class="token punctuation">,</span> item <span class="token keyword">in</span>
            tableView<span class="token punctuation">.</span><span class="token function">dequeueReusableCell</span><span class="token punctuation">(</span>withIdentifier<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">"CELL"</span></span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span></code></pre></p></figure><figure><label for="mn-demo" class="margin-toggle">⊕</label><input type="checkbox" id="mn-demo" class="margin-toggle"><span class="marginnote">Assign the datasource property to the UITableView and create a new snapshot appending a new section and a new item to the section.</span><p class="small"><pre class="  language-swift" tabindex="0"><code class="code  language-swift"><span class="token keyword">class</span> <span class="token class-name">ViewController</span><span class="token punctuation">:</span> <span class="token class-name">UIViewController</span> <span class="token punctuation">{</span>
    <span class="token keyword">func</span> <span class="token function-definition function">viewDidLoad</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">viewDidLoad</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        tableView<span class="token punctuation">.</span>datasource <span class="token operator">=</span> datasource
        <span class="token keyword">var</span> snapshot <span class="token operator">=</span> 
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre></p></figure></section><section><figure><label for="mn-demo" class="margin-toggle">⊕</label><input type="checkbox" id="mn-demo" class="margin-toggle"><span class="marginnote">Assign the datasource property to the UITableView and create a new snapshot appending a new section and a new item to the section.</span><p class="small"><pre data-line="1,8-14" class="  language-swift" tabindex="0"><code class="code  language-swift"><span class="token keyword">class</span> <span class="token class-name">ViewModel</span> <span class="token punctuation">{</span>

    <span class="token comment">//MARK: - OUTPUTS</span>
    <span class="token keyword">let</span> validatedUsername<span class="token punctuation">:</span> <span class="token class-name">Driver</span><span class="token operator">&lt;</span><span class="token class-name">Validation</span><span class="token operator">&gt;</span>
    <span class="token keyword">let</span> validatedPassword<span class="token punctuation">:</span> <span class="token class-name">Driver</span><span class="token operator">&lt;</span><span class="token class-name">Validation</span><span class="token operator">&gt;</span>
    <span class="token keyword">let</span> enabled<span class="token punctuation">:</span> <span class="token class-name">Driver</span><span class="token operator">&lt;</span><span class="token class-name">Bool</span><span class="token operator">&gt;</span>
    <span class="token keyword">let</span> loggedIn<span class="token punctuation">:</span> <span class="token class-name">Driver</span><span class="token operator">&lt;</span><span class="token class-name">Response</span><span class="token operator">&gt;</span>

    <span class="token comment">//MARK: - INPUTS</span>
    <span class="token keyword">init</span><span class="token punctuation">(</span>
        username<span class="token punctuation">:</span> <span class="token class-name">Driver</span><span class="token operator">&lt;</span><span class="token class-name">String</span><span class="token operator">&gt;</span><span class="token punctuation">,</span>
        password<span class="token punctuation">:</span> <span class="token class-name">Driver</span><span class="token operator">&lt;</span><span class="token class-name">String</span><span class="token operator">&gt;</span><span class="token punctuation">,</span>
        login<span class="token punctuation">:</span> <span class="token class-name">AnyPublisher</span><span class="token operator">&lt;</span><span class="token class-name">Void</span><span class="token punctuation">,</span> <span class="token class-name">Never</span><span class="token operator">&gt;</span>
    <span class="token punctuation">)</span> <span class="token punctuation">{</span>

        validatedUsername <span class="token operator">=</span> login<span class="token punctuation">.</span><span class="token function">withLatestFrom</span><span class="token punctuation">(</span>username<span class="token punctuation">)</span><span class="token punctuation">.</span>flatMapLatest <span class="token punctuation">{</span>
            <span class="token class-name">Validator</span><span class="token punctuation">.</span>shared<span class="token punctuation">.</span><span class="token function">username</span><span class="token punctuation">(</span>username<span class="token punctuation">:</span> <span class="token short-argument">$0</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token punctuation">.</span><span class="token function">driver</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

        validatedPassword <span class="token operator">=</span> login<span class="token punctuation">.</span><span class="token function">withLatestFrom</span><span class="token punctuation">(</span>password<span class="token punctuation">)</span><span class="token punctuation">.</span>flatMapLatest <span class="token punctuation">{</span>
            <span class="token class-name">Validator</span><span class="token punctuation">.</span>shared<span class="token punctuation">.</span><span class="token function">password</span><span class="token punctuation">(</span>password<span class="token punctuation">:</span> <span class="token short-argument">$0</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token punctuation">.</span><span class="token function">driver</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

        enabled <span class="token operator">=</span> <span class="token class-name">Publishers</span><span class="token punctuation">.</span><span class="token class-name">CombineLatest</span><span class="token punctuation">(</span>validatedUsername<span class="token punctuation">,</span> validatedPassword<span class="token punctuation">)</span>
        <span class="token punctuation">.</span>flatMapLatest <span class="token punctuation">{</span> username<span class="token punctuation">,</span> password <span class="token operator">-&gt;</span> <span class="token class-name">Driver</span><span class="token operator">&lt;</span><span class="token class-name">Bool</span><span class="token operator">&gt;</span> <span class="token keyword">in</span>
            <span class="token keyword">if</span> <span class="token keyword">case</span> <span class="token punctuation">(</span><span class="token punctuation">.</span>success<span class="token punctuation">,</span> <span class="token punctuation">.</span>success<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token punctuation">(</span>username<span class="token punctuation">,</span> password<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">return</span> <span class="token class-name">Just</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">driver</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">return</span> <span class="token class-name">Just</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">driver</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token punctuation">.</span><span class="token function">driver</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

        loggedIn <span class="token operator">=</span> login<span class="token punctuation">.</span><span class="token function">withLatestFrom</span><span class="token punctuation">(</span><span class="token class-name">Publishers</span><span class="token punctuation">.</span><span class="token class-name">CombineLatest</span><span class="token punctuation">(</span>username<span class="token punctuation">,</span> password<span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span>flatMapLatest <span class="token punctuation">{</span>
                <span class="token class-name">Network</span><span class="token punctuation">.</span>shared<span class="token punctuation">.</span><span class="token function">login</span><span class="token punctuation">(</span>username<span class="token punctuation">:</span> <span class="token short-argument">$0</span><span class="token punctuation">,</span> password<span class="token punctuation">:</span> <span class="token short-argument">$1</span><span class="token punctuation">)</span>
            <span class="token punctuation">}</span><span class="token punctuation">.</span><span class="token function">eraseToAnyPublisher</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><div aria-hidden="true" data-range="1" class=" line-highlight" data-start="1" style="top: 0px; width: 394px;"> 
</div><div aria-hidden="true" data-range="8-14" class=" line-highlight" data-start="8" data-end="14" style="top: 133px; width: 394px;"> 
 
 
 
 
 
 
</div></code></pre></p></figure><figure><label for="mn-demo" class="margin-toggle">⊕</label><input type="checkbox" id="mn-demo" class="margin-toggle"><span class="marginnote"> </span><p class="small"><pre class="  language-swift" tabindex="0"><code class="code  language-swift"></code></pre></p></figure></section><section><h3>Acknowledgements</h3><p>Styles by <a target="_blank" rel="noreferrer noopener" href="https://edwardtufte.github.io/tufte-css/">Tufte-CSS</a>.</p><p>Syntax by <a target="_blank" rel="noreferrer noopener" href="https://prismjs.com/">PrismJS</a></p></section></article></body></html>